---
title: ğŸ”® ì†Œë§ˆë²• í”„ë¡œì íŠ¸ -5 (today)
date: 2020-03-10 16:03:07
category: project
draft: false
---

```toc
exclude: Table of Contents
from-heading: 1
to-heading: 5
```

# \#. Project Map

- <a href="https://small-magic-project.now.sh/" target="_blank">í”„ë¡œì íŠ¸ ì‚¬ì´íŠ¸</a> :apple:

- <a href="https://github.com/taenykim/small-magic-project" target="_blank">í”„ë¡œì íŠ¸ ê¹ƒí—ˆë¸Œì†ŒìŠ¤</a>

<br/>

> ì œì‘ë…¸íŠ¸

- [ì†Œë§ˆë²• í”„ë¡œì íŠ¸ - 1 (container)](https://taeny.dev/project/%EC%86%8C%EB%A7%88%EB%B2%95-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B81/)

- [ì†Œë§ˆë²• í”„ë¡œì íŠ¸ - 2 (calculator)](https://taeny.dev/project/%EC%86%8C%EB%A7%88%EB%B2%95-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B82/)

- [ì†Œë§ˆë²• í”„ë¡œì íŠ¸ - 3 (graph)](https://taeny.dev/project/%EC%86%8C%EB%A7%88%EB%B2%95-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B83/)

- [ì†Œë§ˆë²• í”„ë¡œì íŠ¸ - 4 (crawling)](https://taeny.dev/project/%EC%86%8C%EB%A7%88%EB%B2%95-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B84/)

- [ì†Œë§ˆë²• í”„ë¡œì íŠ¸ - 5 (today)](https://taeny.dev/project/%EC%86%8C%EB%A7%88%EB%B2%95-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B85/)

- [ì†Œë§ˆë²• í”„ë¡œì íŠ¸ - 6 (jjal)](https://taeny.dev/project/%EC%86%8C%EB%A7%88%EB%B2%95-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B86/)

- [ì†Œë§ˆë²• í”„ë¡œì íŠ¸ - 7 (avengers)](https://taeny.dev/project/%EC%86%8C%EB%A7%88%EB%B2%95-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B87/)

# 0. Intro

`Date` ê°ì²´ì™€ `ë‚ ì”¨ api` ë¥¼ ì´ìš©í•œ ì˜¤ëŠ˜ì˜ ë‚ ì§œ, ì‹œê³„, ë‚ ì”¨ ì•±ì„ ë³¼ ìˆ˜ ìˆëŠ” ì–´í”Œë¦¬ì¼€ì´ì…˜.

ì‹œê³„ëŠ” ë§¤ì´ˆë§ˆë‹¤ ë¦¬ë¡œë“œë˜ë©°, ë‚ ì”¨ëŠ” ì´ˆê¸°ë¡œë”© ë•Œë§Œ ë¡œë“œë˜ê²Œ ì„¤ì •í•´ì£¼ì—ˆë‹¤.

> ì½”ë“œ ìŠ¤í”Œë¦¬íŒ…

# 1. ë ˆì´ì•„ì›ƒ

![](./images/today.png)

> ìœ„ì—ì„œë¶€í„° ë‚ ì§œ, ì‹œê°„, ë‚ ì”¨ ìˆœ..

# 2. ì‹œê³„ (Clock)

## 2-1. ìƒíƒœê´€ë¦¬ (state)

```jsx
const weekArr = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† ']

const [year, setYear] = useState('')
const [month, setMonth] = useState('')
const [day, setDay] = useState('')
const [week, setWeek] = useState('')

const [hours, setHours] = useState('')
const [minutes, setMinutes] = useState('')
const [seconds, setSeconds] = useState('')
```

ë…„, ì›”, ì¼, ìš”ì¼, ì‹œê°„, ë¶„, ì´ˆë¥¼ ê°ê° hooks ë¡œ ë§Œë“¤ì–´ì£¼ì—ˆë‹¤.

ê·¸ë¦¬ê³  ìš”ì¼ì„ í•œê¸€ë¡œ ì¶œë ¥í•´ì¤„ ë°°ì—´ì„ ë”°ë¡œ ë§Œë“¤ì–´ì£¼ì—ˆë‹¤.

## 2-2. ë™ì‘ (setInterval)

```jsx
useEffect(() => {
  clock()
  setInterval(clock, 1000)
})

const clock = () => {
  const date = new Date()

  // setTodayDate(date)
  setYear(date.getFullYear())
  setMonth(date.getMonth())
  setDay(date.getDate())
  setWeek(date.getDay())

  setHours(date.getHours())
  setMinutes(date.getMinutes())
  setSeconds(date.getSeconds())
}
```

ë§ˆìš´íŠ¸ê°€ ëë‚˜ê³  `useEffect` í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•  ë•Œ, **clock** í•¨ìˆ˜ë¥¼ í•œë²ˆ ì‹¤í–‰í•˜ê²Œ í•˜ê³ 

ê·¸ë‹¤ìŒë¶€í„°ëŠ” `setInterval` í•¨ìˆ˜ë¡œ **clock**í•¨ìˆ˜ë¥¼ ì£¼ê¸°ì ìœ¼ë¡œ ì‹¤í–‰ë˜ë„ë¡ í•´ì£¼ì—ˆë‹¤.

## 2-3. ë·° (View)

```jsx
<>
  <div style={{ marginTop: '5px', fontSize: '18px', fontFamily: 'escore7' }}>
    {year}ë…„ {month + 1}ì›” {day}ì¼ {weekArr[week]}ìš”ì¼
  </div>
  <div style={{ marginTop: '10px', fontSize: '60px', color: 'orange' }}>
    {hours < 10 ? `0${hours}` : hours}:{minutes < 10 ? `0${minutes}` : minutes}:
    {seconds < 10 ? `0${seconds}` : seconds}
  </div>
</>
```

1.

íƒœê·¸ë“¤ì´ ë³µì¡í•œ êµ¬ì¡°ê°€ ì•„ë‹ˆì—¬ì„œ, styled Component ë§ê³  `style ì†ì„±`ì„ ì‚¬ìš©í–ˆë‹¤.

2.

ì‹œê°„, ë¶„, ì´ˆê°€ í•œìë¦¬ì¼ ê²½ìš° ì•ì— `0`ì„ ë¶™ì—¬ ì–´ìƒ‰í•˜ì§€ ì•Šê²Œ í•´ì£¼ì—ˆë‹¤.

> ì‚¼í•­ ì—°ì‚°ìì™€ í…œí”Œë¦¿ ë¦¬í„°ëŸ´ì„ ì‚¬ìš©í•´ë³´ì•˜ë‹¤.

# 3. ë‚ ì”¨ (Weather)

## 3-1. ìƒíƒœê´€ë¦¬ (state)

```jsx
const [temp, setTemp] = useState('')
const [humidity, setHumidity] = useState('')
const [weather, setWeather] = useState('')
const [weatherIcon, setWeatherIcon] = useState('')
const [country, setCountry] = useState('')
const [city, setCity] = useState('')
const [cloud, setCloud] = useState('')
```

ë‚ ì”¨ì˜ ìƒíƒœ (state) ë„ ë§ˆì°¬ê°€ì§€ë¡œ hooksë¥¼ ì´ìš©í–ˆë‹¤.

ê°ê°, ê¸°ì˜¨, ìŠµë„, ë‚ ì”¨, ë‚ ì”¨ì•„ì´ì½˜, ë‚˜ë¼, ë„ì‹œ, êµ¬ë¦„ì˜ ì–‘ ì´ë‹¤.

## 3-2. ë™ì‘ (openweathermap API)

```jsx
useEffect(() => {
  weather_clock()
})

const weather_clock = () => {
  const url =
    'https://api.openweathermap.org/data/2.5/weather?q=Seoul&appid=5a852cca928001166e0c28dca72c5987'
  fetch(url)
    .then(res => {
      return res.json()
    })
    .then(json => {
      setTemp(Math.round(json.main.temp - 273.15))
      setHumidity(json.main.humidity)
      setWeather(json.weather[0].main)
      setWeatherIcon(json.weather[0].icon)
      setCountry(json.sys.country)
      setCity(json.name)
      setCloud(json.clouds.all + '%')
    })
}
```

ë‚ ì”¨ë„ ë§ˆì°¬ê°€ì§€ë¡œ `useEffect`ë¥¼ ì´ìš©í•´ì„œ í•¨ìˆ˜ë¥¼ ì‹¤í–‰ì‹œì¼œ ë™ì‘í•˜ë„ë¡ í•˜ì˜€ë‹¤.

apië¡œëŠ” `openweathermap API` ë¥¼ ì‚¬ìš©í–ˆë‹¤.

[https://openweathermap.org/](https://openweathermap.org/)

AJAX ëŠ” `fetch` ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ì˜€ë‹¤.

## 3-3. ë·° (View)

```jsx
<>
  <div
    style={{
      marginTop: '4px',
      fontFamily: 'escore8',
      fontSize: '16px',
      textShadow: '2px 2px #ccc',
    }}
  >
    {weather}
  </div>
  <img src={`http://openweathermap.org/img/w/${weatherIcon}.png`} />
  <div
    style={{
      fontSize: '10px',
      fontFamily: 'escore9',
    }}
  >
    {country}, {city},
  </div>
  <div style={{ marginTop: '20px', fontSize: '14px' }}>í˜„ì¬ì˜¨ë„ : {temp}â„ƒ</div>
  <div style={{ marginTop: '10px', fontSize: '14px' }}>
    í˜„ì¬ìŠµë„ : {humidity}%
  </div>
  <div style={{ marginTop: '10px', fontSize: '14px' }}>
    êµ¬ &nbsp; &nbsp; &nbsp; ë¦„ : {cloud}
  </div>
</>
```

ë§ˆì°¬ê°€ì§€ë¡œ styled componentê°€ ì•„ë‹Œ style ì†ì„±ì„ ì´ìš©í–ˆë‹¤.

ê·¸ë¦¬ê³  ë‚ ì”¨ ì´ë¯¸ì§€ ì•„ì´ì½˜ë„ openweathermap API ì—ì„œ ì œê³µì„ í•´ì¤˜ì„œ ê°™ì´ ì‚¬ìš©í•˜ì˜€ë‹¤.

# 4. ì½”ë“œ ìŠ¤í”Œë¦¬íŒ…

## 4-1. today > layout.js

```jsx
// today > layout.js
import React from 'react'
import styled from 'styled-components'
import Weather from './Weather'
import Clock from './Clock'
import ContentsMenubar from '../ContentsMenubar'

const BackgroundContainer = styled.div`
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  width: 100vw;
  height: 100vh;
  background: #f5f6f7;
`

const TodayContainer = styled.div`
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  border-radius: 3px;
  box-shadow: -4px -2px 4px 0px white, 4px 2px 6px 0px #dfe4ea;
  padding: 0px 40px 60px 40px;
`

const Layout = () => {
  return (
    <>
      <BackgroundContainer>
        <TodayContainer>
          <ContentsMenubar name="today" />
          <Clock />
          <Weather />
        </TodayContainer>
      </BackgroundContainer>
    </>
  )
}

export default Layout
```

## 4-2. Error code : 429 (Too many Request)

ì²˜ìŒì—ëŠ” Date ê°ì²´ë¡œ ìƒíƒœë¥¼ ê³„ì† ì—…ë°ì´íŠ¸í•´ì£¼ëŠ” ì½”ë“œì™€ ë‚ ì”¨ apië¡œ ë°ì´í„°ë¥¼ ìš”ì²­, ì‘ë‹µí•˜ëŠ” ì½”ë“œë¥¼ í•œ ê³³ì— ë‘ì—ˆì—ˆë‹¤.

ê·¼ë°, ì“¸ë°ì—†ì´ ì‹œê°„ì„ ì¹´ìš´íŠ¸í•˜ë©´ì„œ ê³„ì† ë‚ ì”¨ api ìš”ì²­ë„ ê³„ì† ë³´ë‚´ì„œ ë‚˜ì¤‘ì—ëŠ” api ì„œë²„ì—ì„œ ì—ëŸ¬(`429 Too many Request`)ë¥¼ ë±‰ì–´ëƒˆë‹¤.

> ë‚´ê°€ ì‚¬ìš©í•œ apiëŠ” ë¬´ë£Œì˜€ê³ , ì´ˆë‹¹ ë°ì´í„°ë¥¼ ë”ë§ì´ ìš”ì²­í•˜ë ¤ë©´ ìœ ë£Œë¡œ ì „í™˜í•´ì•¼í•¨.

ê·¸ë˜ì„œ ì´ˆë‹¹ ì—…ë°ì´íŠ¸ê°€ í•„ìš”í•œ Clock ì»´í¬ë„ŒíŠ¸ì™€ ê¸°ëŠ¥ë“¤,

ê·¸ë¦¬ê³  ì´ˆê¸° ë¡œë”© ë•Œë§Œ ìš”ì²­í•´ë„ ê´œì°®ì€ Weather ì»´í¬ë„ŒíŠ¸ì™€ ê¸°ëŠ¥ë“¤ì„ ë”°ë¡œ ë¹¼ì£¼ì—ˆë‹¤.

> apië¥¼ ì‚¬ìš©í•  ë•Œ, ìš”ì²­ì˜ ì–‘ì´ ì»¤ì§ì— ë”°ë¼ ë¹„ìš©ë„ ì»¤ì§„ë‹¤ëŠ” ê²ƒì„ ì•Œê²Œ ë˜ì—ˆë‹¤.

# 5. ê°œì¸ì ì¸ í”¼ë“œë°±

## 5-1. ì„œë²„ë¦¬ìŠ¤

> [ê³µê³µë°ì´í„°í¬í„¸](https://www.data.go.kr/)ì˜ open API ì§€ì¹¨ì„œ ì¤‘..

![](./images/crossdomain2.png)

ì›ë˜ëŠ” ê¸°ìƒì²­ API ë¥¼ ì‚¬ìš©í•˜ë ¤ í–ˆìœ¼ë‚˜ ë¸Œë¼ìš°ì € ë‚´ javascript ì½”ë“œë¡œ apiì— ì ‘ê·¼í•  ê²½ìš° CORS ì´ìŠˆê°€ ìˆë‹¤ëŠ” ì´ì•¼ê¸°ë¥¼ ë“£ê³  ë‹¤ë¥¸ apië¥¼ ì‚¬ìš©í–ˆë‹¤.

ì´ì „ì˜ [ì†Œë§ˆë²• í”„ë¡œì íŠ¸ - 4 (crawling)](https://taeny.dev/project/%EC%86%8C%EB%A7%88%EB%B2%95-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B84/)í¬ë¡¤ë§ ì•±ì—ì„œë„ ë°œìƒí–ˆì—ˆëŠ”ë° CORSë¬¸ì œë¥¼ ì˜ í•´ê²°í•˜ê¸° ìœ„í•´ì„œëŠ” ì„œë²„ë¥¼ í•˜ë‚˜ ë‘ê³  `ì„œë²„ì™€ í”„ë¡ íŠ¸ì˜ AJAX`, ê·¸ë¦¬ê³  `ì„œë²„ì™€ api í†µì‹ ` ì´ëŸ°ì‹ìœ¼ë¡œ í•˜ëŠ” ê²ƒì´ ì¢‹ì„ ê²ƒ ê°™ë‹¤ê³  ìƒê°í–ˆë‹¤.

> ì‚¬ì‹¤ nodeJS ì—ì„œ ë”°ë¡œ api í†µì‹ ì„ í•´ë³´ì§€ëŠ” ì•Šì•˜ì§€ë§Œ ë‚˜ì¤‘ì— ê¼­ ë™ì¼í•œ api í†µì‹ ì„ ê°€ì§€ê³  `ì›¹ ë¸Œë¼ìš°ì €ì˜ ìë°”ìŠ¤í¬ë¦½íŠ¸ì™€ apií†µì‹ `, ì„œë²„ì˜ `nodeJSì˜ ìë°”ìŠ¤í¬ë¦½íŠ¸ì™€ apií†µì‹ ` ë‘˜ë‹¤ í•˜ë©´ì„œ ë¹„êµí•´ë´ì•¼ê² ë‹¤.

> [ì†Œë§ˆë²• í”„ë¡œì íŠ¸ - 4 (crawling)](https://taeny.dev/project/%EC%86%8C%EB%A7%88%EB%B2%95-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B84/)ì—ì„œë„ ë¸Œë¼ìš°ì €ì—ì„œ ë°œìƒí–ˆë˜ CORS ì´ìŠˆê°€ nodeJS ì—ì„œëŠ” ë°œìƒí•˜ì§€ ì•Šì•˜ë‹¤.
